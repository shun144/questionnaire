import{r as E,j as r,y as F}from"./app-MNzaSWed.js";import{u as s}from"./store-4eFm_Nke.js";import{u as O}from"./index-BV5GjtqN.js";import{n as i}from"./index-CNJg2eKG.js";import"./react-9o_-8awh.js";const _=()=>{const{getNodes:c,getEdges:f,getViewport:m}=O(),a=s(t=>t.firstNodeId),g=s(t=>t.setIsDirty),w=s(t=>t.isDirty),x=s(t=>t.flowId),h=s(t=>t.flowTitle),y=s(t=>t.flowUrl),S=s(t=>t.flowImages),l=s(t=>t.setSubmitError),b=t=>{if(t.preventDefault(),!a){i.error("1問目の質問を作成してください",{duration:5e3});return}const d=c(),N=f(),p=d.filter(o=>o.type==="qNode"),I=d.filter(o=>o.type==="rNode"),{x:j,y:v,zoom:D}=m(),e=new FormData;e.append("update_questions",JSON.stringify(p)),e.append("update_results",JSON.stringify(I)),e.append("update_edges",JSON.stringify(N)),console.log(p),e.append("first_question_id",a.toString()),e.append("title",h),e.append("url",y),e.append("x",j.toString()),e.append("y",v.toString()),e.append("zoom",D.toString()),S.forEach(({nodeId:o,file:n},u)=>{e.append(`images[${u}]`,n),e.append(`imageNodeIds[${u}]`,o)}),F.post(`/flow/${x}`,e,{onSuccess:()=>{l({}),i.success("保存しました",{duration:4e3}),g(!1)},onError:o=>{l(o);for(const n of Object.values(o))i.error(n,{duration:5e3})}})};return r.jsx(r.Fragment,{children:r.jsxs("button",{onClick:b,className:"relative w-full h-full bg-indigo-500 px-2 text-white rounded-md shadow-xl transition-all hover:bg-indigo-600 select-none hover:shadow-xl duration-200",children:["保 存",w&&r.jsxs("span",{className:"absolute flex h-3 w-3 -top-1 -right-1",children:[r.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-rose-400 opacity-75"}),r.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-rose-500 opacity-85"})]})]})})},T=E.memo(_);export{T as default};
